<!doctype html>
<html lang="en" class="default post">
<head>
  
<title>Building a Smart Doorbell with Zigbee, MQTT, and Raspberry Pi</title>
 
<meta name="description" content="Learn how I created a smart doorbell using Zigbee, MQTT, and a Raspberry Pi. This simple DIY project adds sound alerts and notifications through Home Assistant, all powered by my homelab setup." />

<meta charset="utf-8" />
<meta content="IE=edge" http-equiv="X-UA-Compatible" />
<meta content="width=device-width" name="viewport" />
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
<link rel="stylesheet" href="/main.css" />
<link
    href="/apple-touch-icon-57x57.png"
    rel="apple-touch-icon-precomposed"
    sizes="57x57"
/>
<link
    href="/apple-touch-icon-114x114.png"
    rel="apple-touch-icon-precomposed"
    sizes="114x114"
/>
<link
    href="/apple-touch-icon-72x72.png"
    rel="apple-touch-icon-precomposed"
    sizes="72x72"
/>
<link
    href="/apple-touch-icon-144x144.png"
    rel="apple-touch-icon-precomposed"
    sizes="144x144"
/>
<link
    href="/apple-touch-icon-120x120.png"
    rel="apple-touch-icon-precomposed"
    sizes="120x120"
/>
<link
    href="/apple-touch-icon-152x152.png"
    rel="apple-touch-icon-precomposed"
    sizes="152x152"
/>
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" />
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
    href="https://fonts.googleapis.com/css2?family=Inter&family=JetBrains+Mono:ital,wght@0,500;1,500&display=swap"
    rel="stylesheet"
/>

</head>

<body>
  

<div class="navigation">
  <input type="checkbox" id="navigation-controller" />

  <div class="navigation-container">
    <label for="navigation-controller" class="navigation-home">‚åò</label>

    <div class="navigation-menu">
      
      <a class="navigation-menu__link" href="&#x2F;"
        >üìñ <span>blog</span></a
      >
      
      <a class="navigation-menu__link" href="&#x2F;sketchbook"
        >üå± <span>sketchbook</span></a
      >
      
      <a class="navigation-menu__link" href="&#x2F;other"
        >üîÆ <span>other</span></a
      >
      
    </div>
  </div>

  <div class="navigation-menu-mobile">
    
    <a class="navigation-menu-mobile__link" href="&#x2F;"
      >üìñ <span>blog</span></a
    >
    
    <a class="navigation-menu-mobile__link" href="&#x2F;sketchbook"
      >üå± <span>sketchbook</span></a
    >
    
    <a class="navigation-menu-mobile__link" href="&#x2F;other"
      >üîÆ <span>other</span></a
    >
    

    <label
      for="navigation-controller"
      class="navigation-menu-mobile__link navigation-menu-mobile__close"
      >close menu</label
    >
  </div>
</div>



<div id="progress"></div>


<div class="layout">

  <div class="post__heading">
    <h1 class="post__title">Building a Smart Doorbell with Zigbee, MQTT, and Raspberry Pi</h1>
    
</div>


  <div class="post__content content">
    <p>This is a smart doorbell project that came together right after I set up a Zigbee + MQTT hub.</p>
<p>One of my first goals after setting up my <a href="/blog/running-nomad-on-my-homelab/">homelab</a> was to set up a hub for smart home automation. With Nomad, setting up all the prerequisites was straightforward:</p>
<ul>
<li><a href="https://mosquitto.org/">Mosquitto</a> ‚Äî an MQTT broker</li>
<li><a href="https://www.zigbee2mqtt.io/">zigbee2mqtt</a> ‚Äî a bridge between Zigbee and MQTT</li>
<li><a href="https://www.home-assistant.io/">Home Assistant</a> ‚Äî a dashboard and control center for smart home devices</li>
</ul>
<p>Zigbee2MQTT was a fantastic surprise: it‚Äôs practically plug-and-play and extremely powerful. I‚Äôm using an open hardware Zigbee dongle and a few well-known compatible devices, so I expected it to work, but I was blown away by how seamless it was. I made sure the z2m instance had access to the right <code>/dev/</code> on the host, turned on pairing mode, and it instantly started sending data to my MQTT instance.</p>
<p>Nomad HCL for Zigbee2MQTT:</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#bf616a;">job </span><span>&quot;</span><span style="color:#a3be8c;">zigbee2mqtt</span><span>&quot; {
</span><span>  </span><span style="color:#b48ead;">type </span><span>= &quot;</span><span style="color:#a3be8c;">service</span><span>&quot;
</span><span>
</span><span>  </span><span style="color:#bf616a;">group </span><span>&quot;</span><span style="color:#a3be8c;">zigbee2mqtt</span><span>&quot; {
</span><span>    </span><span style="color:#bf616a;">count </span><span>= </span><span style="color:#d08770;">1
</span><span>
</span><span>    </span><span style="color:#bf616a;">service </span><span>{
</span><span>      </span><span style="color:#bf616a;">name </span><span>= &quot;</span><span style="color:#a3be8c;">zigbee2mqtt-web</span><span>&quot;
</span><span>      </span><span style="color:#bf616a;">port </span><span>= &quot;</span><span style="color:#a3be8c;">http</span><span>&quot;
</span><span>
</span><span>      </span><span style="color:#bf616a;">tags </span><span>= [
</span><span>        &quot;</span><span style="color:#a3be8c;">traefik.enable=true</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">traefik.http.routers.z2m.rule=Host(`z2m.home.arpa`)</span><span>&quot;,
</span><span>      ]
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#bf616a;">network </span><span>{
</span><span>      </span><span style="color:#bf616a;">port </span><span>&quot;</span><span style="color:#a3be8c;">http</span><span>&quot; {
</span><span>        </span><span style="color:#bf616a;">to </span><span>= </span><span style="color:#d08770;">8080
</span><span>      }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#bf616a;">task </span><span>&quot;</span><span style="color:#a3be8c;">server</span><span>&quot; {
</span><span>      </span><span style="color:#bf616a;">driver </span><span>= &quot;</span><span style="color:#a3be8c;">docker</span><span>&quot;
</span><span>
</span><span>      </span><span style="color:#bf616a;">env </span><span>{
</span><span>        </span><span style="color:#bf616a;">TZ </span><span>= &quot;</span><span style="color:#a3be8c;">Europe/London</span><span>&quot;
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#bf616a;">config </span><span>{
</span><span>        </span><span style="color:#bf616a;">image </span><span>= &quot;</span><span style="color:#a3be8c;">koenkk/zigbee2mqtt</span><span>&quot;
</span><span>
</span><span>        </span><span style="color:#bf616a;">privileged </span><span>= &quot;</span><span style="color:#a3be8c;">true</span><span>&quot;
</span><span>
</span><span>        </span><span style="color:#bf616a;">ports </span><span>= [
</span><span>          &quot;</span><span style="color:#a3be8c;">http</span><span>&quot;,
</span><span>        ]
</span><span>
</span><span>        </span><span style="color:#bf616a;">volumes </span><span>= [
</span><span>            &quot;</span><span style="color:#a3be8c;">/srv/section9/zigbee2mqtt/data:/app/data</span><span>&quot;,
</span><span>        ]
</span><span>
</span><span>        </span><span style="color:#65737e;">// Access zigbee dongle
</span><span>        </span><span style="color:#bf616a;">devices </span><span>= [
</span><span>          {
</span><span>            </span><span style="color:#bf616a;">host_path </span><span>= &quot;</span><span style="color:#a3be8c;">/dev/serial/by-id/usb-1a86_USB_Serial-if00-port0</span><span>&quot;
</span><span>            </span><span style="color:#bf616a;">container_path </span><span>= &quot;</span><span style="color:#a3be8c;">/dev/ttyACM0</span><span>&quot;
</span><span>          },
</span><span>        ]
</span><span>      }
</span><span>    }
</span><span>  }
</span><span>}
</span><span>
</span></code></pre>
<h2 id="the-doorbell-project">The doorbell project</h2>
<p>I‚Äôd already picked up a few affordable Zigbee sensors and controls, hoping to find some interesting uses for them.</p>
<p>Then, inspiration struck: my doorbell is broken. Eventually I want to fix it, it‚Äôs nice looking retro bakerlite thing, but the contacts are burnt out. My initial plan was to replace it temporarily with a wireless model, but why not make a smart doorbell instead?</p>
<p>I had already paired a Zigbee switch and verified it was sending data smoothly to MQTT. And since I had a Raspberry Pi set up as a hi-fi speaker (my ‚ÄúPi-Fi‚Äù), it was all ready to go ‚Äî typically used with AirPlay, but essentially a Linux box with a [hi-fi amp hat].</p>
<p>I just needed to play a sound in response to an MQTT event. So, I downloaded a doorbell sound, tested it with <code>aplay</code>, and ran a <code>mosquitto_sub</code> to confirm the topic I needed to subscribe to. Sound, check. Events, check.</p>
<div class="embed">
  <img src="/assets/images/blog/speaker.jpg" class="centered" />
  <p>The speaker and zigbee button.</p>
</div>
<p>‚Ä¶And then the dreaded bikeshedding brain kicked in: ‚ÄúShould I write a program for this? What language? JS/Node is familiar, but maybe I should try something new? Which MQTT library? Should I launch <code>aplay</code> from the app, or find an audio library?‚Äù Thankfully I snapped out of it ‚Äî why not keep it simple and use the command-line tools I‚Äôd just tested? KISS.</p>
<p>After a quick search, I <a href="https://stackoverflow.com/questions/73560635/subscribe-a-bash-script-to-run-when-mqtt-message-is-received">found an example</a> and adapted it to my needs:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;">#!/usr/bin/env sh
</span><span>
</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">Starting doorbell...</span><span>&quot;
</span><span>
</span><span style="color:#65737e;"># `home.arpa` is the mqtt broker
</span><span style="color:#65737e;"># `zigbee2mqtt/cmd/controls/doorbell/action` is the topic published by z2m when the button is pressed
</span><span style="color:#bf616a;">mosquitto_sub -h</span><span> home.arpa</span><span style="color:#bf616a;"> -t</span><span> zigbee2mqtt/cmd/controls/doorbell/action |
</span><span>    </span><span style="color:#b48ead;">while </span><span style="color:#96b5b4;">read</span><span> payload ; </span><span style="color:#b48ead;">do
</span><span>       </span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">Doorbell rang!</span><span>&quot;
</span><span>       </span><span style="color:#bf616a;">aplay</span><span> /opt/doorbell/doorbell.wav
</span><span>    </span><span style="color:#b48ead;">done
</span><span>
</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">Doorbell stopped.</span><span>&quot;
</span></code></pre>
<p>I set up the necessary systemd configuration to run this as a service on the Pi-Fi.</p>
<p>I was tempted to post a video, but filming a speaker playing a sound isn‚Äôt that compelling üòÇ</p>
<p>And the final cherry on top: Home Assistant can also subscribe to MQTT and includes an automation feature. Now, when the doorbell is pressed, I get a notification ‚Äî even on my watch!</p>
<div class="embed">
  <img src="/assets/images/blog/watch.jpg" class="centered" />
  <p>Home assistant notification on my watch.</p>
</div>
<p>This was so satisfying to implement ‚Äî simple in approach, but fully leaning into the sophisticated software stack I already have running.</p>

  </div>

  <div class="post__end"></div>

</div>

  
</body>
</html>
